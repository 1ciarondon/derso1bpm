<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Solicitação de Folga - DERSO</title>
<style>
  body {
    background-color: #ffffff;
    font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    color: #333;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  header {
    background-color: #004d99;
    width: 100%;
    padding: 10px 0;
    text-align: center;
    color: white;
  }
  .header-logos {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 5px;
  }
  .header-logos img { height: 70px; width: auto; }
  header h1 { margin: 0; font-size: 22px; }

  .container {
    width: 95%;
    max-width: 500px;
    background-color: #f7f7f7;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    margin-top: 20px;
  }

  h2, .subtitle { text-align: center; margin-bottom: 5px; }
  h2 { color: #004d99; font-size: 24px; font-weight: 600; }
  .subtitle { color: #5a5a5a; font-size: 15px; margin-bottom: 25px; }

  .form-group { margin-bottom: 20px; width: 100%; }
  .form-group label { display: block; margin-bottom: 8px; color: #4a4a4a; font-weight: 500; font-size: 14px; }
  input:not([type="radio"]), select { width: 100%; padding: 12px 15px; font-size: 15px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
  input:not([type="radio"]):focus, select:focus { border-color: #007bff; outline: none; box-shadow: 0 0 0 3px rgba(0,123,255,0.2); }
  input[readonly] { background-color: #e9ecef; cursor: not-allowed; }
  input[id="matricula"]::placeholder { color: #aaa; }

  .radio-group {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-top: 10px;
  }
  .radio-group label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    cursor: pointer;
    user-select: none;
    color: #5a5a5a;
  }

  .button {
    background-color: #007bff;
    color: #fff;
    border: none;
    cursor: pointer;
    padding: 14px 20px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 8px;
    transition: background-color 0.3s ease, transform 0.2s ease;
    display: block;
    width: 100%;
    box-sizing: border-box;
  }
  .button:hover { background-color: #0056b3; transform: translateY(-2px); }
  .button:active { transform: translateY(0); }

  .error { color: #dc3545; margin-top: 5px; font-size: 12px; font-weight: 500; }
  .required-star { color: #dc3545; margin-left: 2px; }
  .destaque-encerrou { color: #dc3545; font-weight: bold; }
  .destaque-iniciara { color: #28a745; font-weight: bold; }

  footer {
    width: 100%;
    background-color: #004d99;
    color: #fff;
    text-align: center;
    padding: 12px;
    margin-top: 20px;
    font-size: 14px;
  }

  @media (max-width: 576px) {
    .container { padding: 20px; }
    h2 { font-size: 20px; }
    .subtitle { font-size: 13px; }
    input:not([type="radio"]), select { font-size: 14px; }
    .button { font-size: 14px; padding: 12px 15px; }
    .radio-group { flex-direction: column; gap: 10px; }
  }
</style>
</head>
<body>

<header>
  <div class="header-logos">
    <img src="https://rondonia.ro.gov.br/wp-content/uploads/2024/09/Brasao-PMRO-370x523.png" alt="Brasão PMRO">
    <img src="https://museu.pm.ro.gov.br/wp-content/uploads/2024/05/1-bpm-3.png" alt="1º BPM">
  </div>
  <h1>DERSO - 1º BPM</h1>
</header>

<div class="container" id="formulario">
  <h2>DERSO 1º BPM</h2>
  <p class="subtitle" id="subtitle">Formulário de DERSO - 1º BPM</p>

  <form id="dersoForm" style="display: none;">
    <div class="form-group">
      <label for="email">E-mail:</label>
      <input type="email" id="email" name="email" list="emailProviders" required autofocus>
      <datalist id="emailProviders"></datalist>
    </div>

    <div class="form-group">
      <label for="matricula">Matrícula:</label>
      <input type="text" id="matricula" name="matricula" required placeholder="Ex: 12345 ou 100012345">
      <div id="matriculaError" class="error"></div>
    </div>

    <div class="form-group">
      <label for="nome">Nome:</label>
      <input type="text" id="nome" name="nome" readonly required>
    </div>

    <div class="form-group">
      <label>Tipo de Folga<span class="required-star">*</span>:</label>
      <div class="radio-group">
        <label><input type="radio" name="folga" value="24H">24H</label>
        <label><input type="radio" name="folga" value="48H">48H</label>
        <label><input type="radio" name="folga" value="72H">72H</label>
        <label><input type="radio" name="folga" value="96H">96H</label>
        <label><input type="radio" name="folga" value="FOLGA LE">FOLGA LE</label>
        <label><input type="radio" name="folga" value="1ª Folga">1ª FOLGA</label>
        <label><input type="radio" name="folga" value="2ª Folga">2ª FOLGA</label>
        <label><input type="radio" name="folga" value="Expediente">EXPEDIENTE</label>
      </div>
      <div id="duplicateError" class="error"></div>
    </div>

    <div class="form-group">
      <label for="data">Data:</label>
      <input type="date" id="data" name="data" required>
    </div>

    <button type="submit" class="button">Enviar Solicitação</button>
  </form>

  <div id="statusMessage" class="info-message"></div>
</div>

<footer id="rodape"></footer>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwvXdbm_hZW8KUfg-1ifd754dkebUiOc9sf0xoQDF2NCswP9CaUG0vYjiF1wFxep20lUA/exec";
const emailProviders = ["gmail.com", "hotmail.com", "outlook.com", "yahoo.com", "terra.com.br", "bol.com.br"];
window.employeeList = {};

// --- LOGO e RODAPÉ ---
const rodape = document.getElementById("rodape");
const hoje = new Date();
const mesAtual = hoje.toLocaleString("pt-BR", { month: "long" });
const anoAtual = hoje.getFullYear();
rodape.textContent = `Desenvolvido na 1ª Cia do 1º BPM pelo PVSA Pedro Porto — ${mesAtual.charAt(0).toUpperCase()+mesAtual.slice(1)}/${anoAtual}`;

// --- DATA AUTOMÁTICA (PRÓXIMO MÊS) ---
const dataInput = document.getElementById("data");
let mes = hoje.getMonth()+2;
let ano = hoje.getFullYear();
if(mes>12){mes=1;ano++;}
const primeiroDia = new Date(ano, mes-1, 1);
const ultimoDia = new Date(ano, mes, 0);
dataInput.value = primeiroDia.toISOString().split("T")[0];
dataInput.min = primeiroDia.toISOString().split("T")[0];
dataInput.max = ultimoDia.toISOString().split("T")[0];

// --- FUNÇÕES EXISTENTES ---
function updateEmailDatalist(){ const emailInput=document.getElementById("email"); const datalist=document.getElementById("emailProviders"); const value=emailInput.value; const atIndex=value.indexOf("@"); if(atIndex===-1){datalist.innerHTML="";return;} const domainPart=value.slice(atIndex+1).toLowerCase(); const filtered=emailProviders.filter(p=>p.startsWith(domainPart)); datalist.innerHTML=""; filtered.forEach(p=>{const option=document.createElement("option");option.value=value.slice(0,atIndex+1)+p;datalist.appendChild(option);}); }

function standardizeMatricula(m){let num=m.replace(/\D/g,'');return num.startsWith("1000")?num:"1000"+num;}
function loadEmployeeList(){fetch(SCRIPT_URL+"?action=lista").then(r=>r.json()).then(data=>{if(!data.error)window.employeeList=data;}).catch(()=>{});}
function checkMatricula(){const m=document.getElementById("matricula");const n=document.getElementById("nome");const e=document.getElementById("matriculaError");const s=standardizeMatricula(m.value);m.value=s;if(window.employeeList[s]){n.value=window.employeeList[s];e.textContent="";}else{n.value="";e.textContent="Matrícula não encontrada!";}}
function formatDateToBR(d){if(!d)return"";const [y,m,dia]=d.split("-");return`${dia}/${m}/${y}`;}
function submitForm(ev){ev.preventDefault();const f=document.getElementById("dersoForm");const fd=new FormData(f);fd.set("data",formatDateToBR(document.getElementById("data").value));const folga=document.querySelector('input[name="folga"]:checked');if(!folga){document.getElementById("duplicateError").textContent="Por favor, selecione uma opção de folga.";return;}fd.set("folga",folga.value);document.getElementById("duplicateError").textContent="";const n=document.getElementById("nome");if(n.value.trim()===""){document.getElementById("matriculaError").textContent="Matrícula inválida. Por favor, corrija.";document.getElementById("matricula").focus();return;}const btn=document.querySelector(".button");btn.disabled=true;fetch(SCRIPT_URL,{method:"POST",body:new URLSearchParams(fd)}).then(r=>r.json()).then(d=>{if(d.success){alert("Solicitação enviada com sucesso!");f.reset();document.getElementById("email").focus();}else{document.getElementById("duplicateError").textContent=d.error;}}).catch(e=>{console.error(e);alert("Erro ao enviar!");}).finally(()=>{btn.disabled=false;});}

function initializeForm(){const f=document.getElementById("dersoForm");const s=document.getElementById("statusMessage");fetch(SCRIPT_URL+'?action=datas').then(r=>r.json()).then(data=>{const a=new Date(data.abertura);const e=new Date(data.fechamento);const agora=new Date();if(agora<a||agora>e){const msg=agora<a?`<h3>O período de solicitações será aberto em <span class="destaque-iniciara">${a.toLocaleString("pt-BR",{timeZone:"America/Porto_Velho"})}</span>.</h3>`:`<h3>O período de solicitações foi encerrado em <span class="destaque-encerrou">${e.toLocaleString("pt-BR",{timeZone:"America/Porto_Velho"})}</span>.</h3>`;s.innerHTML=`<div class="info-message">${msg}</div>`;f.style.display="none";}else{f.style.display="block";s.style.display="none";}}).catch(()=>{s.innerHTML='<h3>Erro ao carregar datas. Tente novamente mais tarde.</h3>';});}

document.addEventListener("DOMContentLoaded",()=>{
  loadEmployeeList();
  initializeForm();
  document.getElementById("matricula").addEventListener("blur",checkMatricula);
  document.getElementById("email").addEventListener("input",updateEmailDatalist);
  document.getElementById("dersoForm").addEventListener("submit",submitForm);
});
</script>

</body>
</html>
