<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Solicitações</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h2>Consultar Solicitação</h2>
    <label for="matricula">Matrícula:</label>
    <input type="text" id="matricula">
    <button onclick="filtrarTabela()">Buscar</button>
    
    <table id="tabela">
        <thead>
            <tr>
                <th>E-mail</th>
                <th>Nome</th>
                <th>Folga</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        // URL do Apps Script para carregar as solicitações
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwsIMa4U7n1wnT1kU_WU-sAZv-RfyteZEif6Lf6T-5M/exec";

        // Lista global de solicitações
        let solicitacoesList = [];

        // Função para carregar as solicitações da API
        function loadSolicitacoesList(matricula) {
            fetch(`${SCRIPT_URL}?action=solicitacoes&matricula=${matricula}`)
                .then(response => response.json())
                .then(data => {
                    solicitacoesList = data.map(dateStr => {
                        const date = new Date(dateStr); // Converte a string para um objeto Date
                        const day = String(date.getDate()).padStart(2, '0');
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const year = date.getFullYear();
                        return `${day}/${month}/${year}`; // Formata a data
                    });
                    console.log(solicitacoesList); // Exibe as datas formatadas no console
                })
                .catch(error => {
                    console.error('Erro ao carregar as solicitações:', error);
                });
        }

        // Função para padronizar a matrícula
        function standardizeMatricula(matricula) {
            let num = matricula.replace(/\D/g, ''); // Remove caracteres não numéricos
            if (!num.startsWith("1000")) {
                num = "1000" + num;
            }
            return num;
        }

        // Função para filtrar a tabela com base na matrícula
        function filtrarTabela() {
            const matricula = document.getElementById("matricula").value.trim(); // Remove espaços extras
            const tbody = document.getElementById("tabela").getElementsByTagName("tbody")[0];
            tbody.innerHTML = ""; // Limpa a tabela antes de adicionar os resultados

            if (!matricula) {
                alert("Por favor, insira uma matrícula.");
                return;
            }

            const matriculaPadronizada = standardizeMatricula(matricula);
            console.log("Matrícula padronizada:", matriculaPadronizada);

            // Carregar a lista de solicitações
            loadSolicitacoesList(matriculaPadronizada);

            // Preenche a tabela com os dados encontrados
            // Exemplo de dados fictícios para a tabela (deve ser substituído pelos dados reais)
            const resultados = [
                { email: "exemplo@dominio.com", nome: "João da Silva", folga: "Sim", data: solicitacoesList.join(", ") }
            ];

            resultados.forEach(dado => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = dado.email;
                row.insertCell(1).textContent = dado.nome;
                row.insertCell(2).textContent = dado.folga;
                row.insertCell(3).textContent = dado.data;
            });

            if (resultados.length === 0) {
                alert("Nenhuma solicitação encontrada para a matrícula informada.");
            }
        }

        // Evento para padronizar a matrícula ao sair do campo de entrada
        document.getElementById("matricula").addEventListener("blur", function() {
            const matriculaInput = document.getElementById("matricula");
            matriculaInput.value = standardizeMatricula(matriculaInput.value);
        });
    </script>
</body>
</html>
